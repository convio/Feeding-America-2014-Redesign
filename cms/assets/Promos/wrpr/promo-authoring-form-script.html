<script type="text/javascript">
/*!
* jQuery Text Counter Plugin v0.2.1
* https://github.com/ractoon/jQuery-Text-Counter
*
* Copyright 2014 ractoon
* Released under the MIT license
*/
;(function(a){a.textcounter=function(c,b){var d=this;d.$el=a(c);d.el=c;d.$el.data("textcounter",d);d.init=function(){d.options=a.extend({},a.textcounter.defaultOptions,b);var f=d.options.countDown?d.options.countDownText:d.options.counterText,e=d.options.countDown?d.options.max:0;d.$el.after("<"+d.options.countContainerElement+' class="'+d.options.countContainerClass+'">'+f+'<span class="text-count">'+e+"</span></"+d.options.countContainerElement+">");d.$el.bind("keyup.textcounter click.textcounter blur.textcounter focus.textcounter change.textcounter paste.textcounter",d.checkLimits).trigger("click.textcounter")};d.checkLimits=function(o){var p=d.$el,t=p.next("."+d.options.countContainerClass),r=p.val(),h=0,u=0,s=o.originalEvent===undefined?false:true;if(d.options.type=="word"){h=r.replace(/\s+/g," ").split(" ").length;if(p.val()===""){h=0}}else{if(d.options.countSpaces){h=r.replace(/\n/g,"\r\n").length}else{h=r.replace(/\s/g,"").length}if(d.options.countExtendedCharacters){var l=r.match(/[^\x00-\xff]/gi);if(l==null){h=r.length}else{h=r.length+l.length}}}if(d.options.max=="auto"){var q=d.$el.attr("maxlength");if(typeof q!=="undefined"&&q!==false){d.options.max=q}else{d.$el.next("."+d.options.countContainerClass).text("error: [maxlength] attribute not set")}}u=d.options.countDown?d.options.max-h:h;d.setCount(u);if(d.options.min>0&&s){if(h<d.options.min){d.setErrors("min")}else{if(h>=d.options.min){d.clearErrors("min")}}}if(d.options.max!==-1){if(h>d.options.max&&d.options.max!=0){if(d.options.stopInputAtMaximum){var k="";if(d.options.type=="word"){var m=r.split(/[\s\.\?]+/);for(var j=0;j<d.options.max;j++){k+=m[j]+" "}}else{if(d.options.countSpaces){k=r.substring(0,d.options.max)}else{var g=r.split(""),n=g.length,f=0,j=0;while(f<d.options.max&&j<n){if(g[j]!==" "){f++}k+=g[j++]}}}p.val(k);u=d.options.countDown?0:d.options.max;d.setCount(u)}else{d.setErrors("max")}}else{d.clearErrors("max")}}};d.setCount=function(f){var g=d.$el,e=g.next("."+d.options.countContainerClass);e.children(".text-count").text(f)};d.setErrors=function(e){var g=d.$el,f=g.next("."+d.options.countContainerClass);g.addClass(d.options.inputErrorClass);f.addClass(d.options.counterErrorClass);if(d.options.displayErrorText){switch(e){case"min":errorText=d.options.minimumErrorText;break;case"max":errorText=d.options.maximumErrorText;break}if(!f.children(".error-text-"+e).length){f.append("<"+d.options.errorTextElement+' class="error-text error-text-'+e+'">'+errorText+"</"+d.options.errorTextElement+">")}}};d.clearErrors=function(e){var g=d.$el,f=g.next("."+d.options.countContainerClass);f.children(".error-text-"+e).remove();if(f.children(".error-text").length==0){g.removeClass(d.options.inputErrorClass);f.removeClass(d.options.counterErrorClass)}};d.init()};a.textcounter.defaultOptions={type:"character",min:0,max:270,countContainerElement:"div",countContainerClass:"text-count-wrapper",inputErrorClass:"error",counterErrorClass:"error",counterText:"Total Count: ",errorTextElement:"div",minimumErrorText:"Minimum not met",maximumErrorText:"Maximum exceeded",displayErrorText:true,stopInputAtMaximum:true,countSpaces:false,countDown:false,countDownText:"Remaining: ",countExtendedCharacters:false};a.fn.textcounter=function(b){return this.each(function(){new a.textcounter(this,b)})}})(jQuery);

  jQuery(document).ready(function($) {

    var $promoType = $('.promoType');
    var $promoTypeSelect = $('#promo_type');
    var $promoTitle = $('.promoTitle');
    var $promoFilename = $('.promoFilename');
    var $promoHeadline = $('.promoHeadline');
    var $promoDescription = $('.promoDescription');
    var $promoDate = $('.promoDate');
    var $promoConditionalGroup = $('.promoConditionalGroup');
    var $promoSection = $('.promoSection');
    var $promoGlobal = $('.promoGlobal');


    var $promoStructuredInstructions = $('.promoStructuredInstructions');
    var $promoImage = $('.promoImage');
    var $promoMobileImage = $('.promoMobileImage');
    var $promoBannerStyle = $('.promoBannerStyle');
    var $promoBackgroundImage = $('.promoBackgroundImage');
    var $promoBackgroundColor = $('.promoBackgroundColor');
    var $promoButtonColor = $('.promoButtonColor');
    var $promoButtonStyle = $('.promoButtonStyle');
    var $promoButtonLabel = $('.promoButtonLabel');
    var $promoLink = $('.promoLink');
    var $promoTemplate = $('.promoTemplate');
    var $promoTemplateSelect = $('#form-template');
    var $promoWrapper = $('.promoWrapper');

    var $footerPromoInstructions = $('.footerPromoInstructions');
    var $sidebarPromosInstructions = $('.sidebarPromoInstructions');
    var $bannerPromoInstructions = $('.bannerPromoInstructions');
    var $inlinePromoInstructions = $('.inlinePromoInstructions');
    var $interrupterPromoInstructions = $('.interrupterPromoInstructions');
    var $urgentBannerPromoInstructions = $('.urgentBannerPromoInstructions');
    var $homeEmailPromoInstructions = $('.homeEmailPromoInstructions');
    var $homeFactoidsPromoInstructions = $('.homeFactoidsPromoInstructions');
    var $promoBodyInstructions = $('.promoBodyInstructions');

    var $headline = $('#headline');
    var $subtitle = $('#form-description');
    var $buttonLabel = $('#action_button_label');

    var $countedInputs = $([$headline, $subtitle, $buttonLabel]);
    $countedInputs.textcounter({ type: 'character', 'counterText' : 'Characters Entered: ', });

    $.fn.extend({
      setTemplate: function(templateName) {
        var $options = $(this).find('option');
        var $option = $options.filter(function() {
          if($(this).text() == templateName) {
            return this;
          }
        });
        $options.removeAttr('selected');
        $option.attr('selected', 'selected');
      }
    });

    var hiddenDefaults = jQuery([$promoHeadline, $promoDescription, $promoConditionalGroup, $promoSection, $promoGlobal, $promoStructuredInstructions, $promoImage, $promoMobileImage, $promoBannerStyle, $promoBackgroundImage, $promoBackgroundColor, $promoButtonColor, $promoButtonStyle, $promoButtonLabel, $promoLink, $promoBodyInstructions, $footerPromoInstructions, $sidebarPromosInstructions, $bannerPromoInstructions, $inlinePromoInstructions, $interrupterPromoInstructions, $urgentBannerPromoInstructions, $homeEmailPromoInstructions, $homeFactoidsPromoInstructions]);


    if($promoTypeSelect.length > 0) {
      hiddenDefaults.each(function() { $(this).hide() });

      $promoTypeSelect.on('change', function() {
        hiddenDefaults.each(function() { $(this).hide() });
        var selectedType = $(this).find('option:selected').text();

        switch(selectedType) {
          case 'Contextual Sidebar Promo':
          case 'Second Sidebar Promo':
            var visibleFields = jQuery([$promoHeadline, $promoDescription, $promoConditionalGroup, $promoSection, $promoGlobal, $promoStructuredInstructions, $promoImage, $promoBackgroundImage, $promoBackgroundColor, $promoButtonColor, $promoButtonStyle, $promoButtonLabel, $promoLink, $promoBodyInstructions, $sidebarPromosInstructions]);
            visibleFields.each(function() { $(this).show(); });
            $promoTemplateSelect.setTemplate('Sidebar Promo');
            break;

          case 'Footer - Act / Share':
          case 'Footer - Give / Thanks':
          case 'Footer - Join / Learn':
            var visibleFields = jQuery([$promoHeadline, $promoDescription, $promoConditionalGroup, $promoSection, $promoGlobal, $promoStructuredInstructions, $promoImage, $promoButtonColor, $promoButtonStyle, $promoButtonLabel, $promoLink, $promoBodyInstructions, $footerPromoInstructions]);
            visibleFields.each(function() { $(this).show(); });
            $promoTemplateSelect.setTemplate('Footer Promo');
            break;

          case 'Homepage Email Sign Up':
            var visibleFields = jQuery([$promoHeadline, $promoDescription, $promoStructuredInstructions, $promoBackgroundImage, $promoBackgroundColor, $promoButtonColor, $promoButtonStyle, $promoButtonLabel, $promoLink, $promoConditionalGroup, $homeEmailPromoInstructions, $promoBodyInstructions]);
            visibleFields.each(function() { $(this).show(); });
            $promoTemplateSelect.setTemplate('Homepage Email Promo');
            break;

          case 'Homepage How We Work / Did You Know Factoid':
            var visibleFields = jQuery([$promoHeadline, $promoStructuredInstructions, $promoBackgroundImage, $promoBackgroundColor, $promoLink, $promoBodyInstructions, $homeFactoidsPromoInstructions]);
            visibleFields.each(function() { $(this).show(); });
            $promoTemplateSelect.setTemplate('Homepage Factoid Promo');
            break;

          case 'Inline Promo':
            var visibleFields = jQuery([$promoHeadline, $promoSection, $promoGlobal, $promoStructuredInstructions, $promoImage, $promoBackgroundImage, $promoBackgroundColor, $promoLink, $inlinePromoInstructions]);
            visibleFields.each(function() { $(this).show(); });
            $promoTemplateSelect.setTemplate('Inline Promo');
            break;

          case 'Interrupter':
            var visibleFields = jQuery([ $promoConditionalGroup, $promoSection, $promoGlobal, $promoStructuredInstructions, $promoImage, $promoBackgroundImage, $promoBodyInstructions, $interrupterPromoInstructions]);
            visibleFields.each(function() { $(this).show(); });
            $promoTemplateSelect.setTemplate('Interrupter Promo');
            break;

          case 'Top Urgent Alert Banner':
            var visibleFields = jQuery([$promoSection, $promoGlobal, $promoStructuredInstructions, $promoImage, $promoBackgroundColor, $promoBackgroundImage, $promoBodyInstructions, $urgentBannerPromoInstructions]);
            visibleFields.each(function() { $(this).show(); });
            $promoTemplateSelect.setTemplate('Alert Promo');
            break;

          case 'Full Width Banner':
            var visibleFields = jQuery([$promoHeadline, $promoDescription, $promoStructuredInstructions, $promoBannerStyle, $promoBackgroundColor, $promoBackgroundImage, $bannerPromoInstructions, $promoBodyInstructions, ]);
            visibleFields.each(function() { $(this).show(); });
            $promoTemplateSelect.setTemplate('Full Width Banner Promo');
            break;

        }
      });

      $promoTypeSelect.trigger('change');
    }



  });
</script>